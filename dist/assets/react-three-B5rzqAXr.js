import{r as m,j as G}from"./react-Lfnj0zCF.js";import{s as Bt,c as ae,R as Nt,O as Ne,P as Ue,S as Ut,a as _e,V as Gt,b as Vt,B as qt,N as Xt,A as Yt,d as Zt,W as Kt,C as Jt,e as $,f as mt,g as Qt,h as et,L as Ce,i as er,U as tr,p as rr,j as nr,F as or,u as ir,k as sr,T as ar,_ as K,D as cr,l as lr,m as be,n as Ge,o as tt,q as ur,E as vt,M as fr,r as dr,t as pr,G as Ve,v as mr,w as Re,x as vr,y as hr,z as gr,H as ce,I as yr,J as br,K as wr}from"./vendor-Z1tZta7Z.js";import{c as xr}from"./react-dom-DYOQhaLE.js";function Sr(e){let t;const r=new Set,o=(v,n)=>{const i=typeof v=="function"?v(t):v;if(i!==t){const p=t;t=n?i:Object.assign({},t,i),r.forEach(l=>l(t,p))}},a=()=>t,s=(v,n=a,i=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let p=n(t);function l(){const f=n(t);if(!i(p,f)){const x=p;v(p=f,x)}}return r.add(l),()=>r.delete(l)},c={setState:o,getState:a,subscribe:(v,n,i)=>n||i?s(v,n,i):(r.add(v),()=>r.delete(v)),destroy:()=>r.clear()};return t=e(o,a,c),c}const Er=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),rt=Er?m.useEffect:m.useLayoutEffect;function Mr(e){const t=typeof e=="function"?Sr(e):e,r=(o=t.getState,a=Object.is)=>{const[,s]=m.useReducer(b=>b+1,0),h=t.getState(),g=m.useRef(h),c=m.useRef(o),v=m.useRef(a),n=m.useRef(!1),i=m.useRef();i.current===void 0&&(i.current=o(h));let p,l=!1;(g.current!==h||c.current!==o||v.current!==a||n.current)&&(p=o(h),l=!a(i.current,p)),rt(()=>{l&&(i.current=p),g.current=h,c.current=o,v.current=a,n.current=!1});const f=m.useRef(h);rt(()=>{const b=()=>{try{const u=t.getState(),y=c.current(u);v.current(i.current,y)||(g.current=u,i.current=y,s())}catch{n.current=!0,s()}},d=t.subscribe(b);return t.getState()!==f.current&&b(),d},[]);const x=l?p:i.current;return m.useDebugValue(x),x};return Object.assign(r,t),r[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const o=[r,t];return{next(){const a=o.length<=0;return{value:o.shift(),done:a}}}},r}const qe={},Pr=e=>void Object.assign(qe,e);function _r(e,t){function r(n,{args:i=[],attach:p,...l},f){let x=`${n[0].toUpperCase()}${n.slice(1)}`,b;if(n==="primitive"){if(l.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const d=l.object;b=ie(d,{type:n,root:f,attach:p,primitive:!0})}else{const d=qe[x];if(!d)throw new Error(`R3F: ${x} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(i))throw new Error("R3F: The args prop must be an array!");b=ie(new d(...i),{type:n,root:f,attach:p,memoizedProps:{args:i}})}return b.__r3f.attach===void 0&&(b.isBufferGeometry?b.__r3f.attach="geometry":b.isMaterial&&(b.__r3f.attach="material")),x!=="inject"&&Ae(b,l),b}function o(n,i){let p=!1;if(i){var l,f;(l=i.__r3f)!=null&&l.attach?Oe(n,i,i.__r3f.attach):i.isObject3D&&n.isObject3D&&(n.add(i),p=!0),p||(f=n.__r3f)==null||f.objects.push(i),i.__r3f||ie(i,{}),i.__r3f.parent=n,$e(i),se(i)}}function a(n,i,p){let l=!1;if(i){var f,x;if((f=i.__r3f)!=null&&f.attach)Oe(n,i,i.__r3f.attach);else if(i.isObject3D&&n.isObject3D){i.parent=n,i.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:i});const b=n.children.filter(u=>u!==i),d=b.indexOf(p);n.children=[...b.slice(0,d),i,...b.slice(d)],l=!0}l||(x=n.__r3f)==null||x.objects.push(i),i.__r3f||ie(i,{}),i.__r3f.parent=n,$e(i),se(i)}}function s(n,i,p=!1){n&&[...n].forEach(l=>h(i,l,p))}function h(n,i,p){if(i){var l,f,x;if(i.__r3f&&(i.__r3f.parent=null),(l=n.__r3f)!=null&&l.objects&&(n.__r3f.objects=n.__r3f.objects.filter(M=>M!==i)),(f=i.__r3f)!=null&&f.attach)at(n,i,i.__r3f.attach);else if(i.isObject3D&&n.isObject3D){var b;n.remove(i),(b=i.__r3f)!=null&&b.root&&Lr(Ee(i),i)}const u=(x=i.__r3f)==null?void 0:x.primitive,y=!u&&(p===void 0?i.dispose!==null:p);if(!u){var d;s((d=i.__r3f)==null?void 0:d.objects,i,y),s(i.children,i,y)}if(delete i.__r3f,y&&i.dispose&&i.type!=="Scene"){const M=()=>{try{i.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?et.unstable_scheduleCallback(et.unstable_IdlePriority,M):M()}se(n)}}function g(n,i,p,l){var f;const x=(f=n.__r3f)==null?void 0:f.parent;if(!x)return;const b=r(i,p,n.__r3f.root);if(n.children){for(const d of n.children)d.__r3f&&o(b,d);n.children=n.children.filter(d=>!d.__r3f)}n.__r3f.objects.forEach(d=>o(b,d)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(x,n),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),o(x,b),b.raycast&&b.__r3f.eventCount&&Ee(b).getState().internal.interaction.push(b),[l,l.alternate].forEach(d=>{d!==null&&(d.stateNode=b,d.ref&&(typeof d.ref=="function"?d.ref(b):d.ref.current=b))})}const c=()=>{};return{reconciler:Zt({createInstance:r,removeChild:h,appendChild:o,appendInitialChild:o,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,i)=>{if(!i)return;const p=n.getState().scene;p.__r3f&&(p.__r3f.root=n,o(p,i))},removeChildFromContainer:(n,i)=>{i&&h(n.getState().scene,i)},insertInContainerBefore:(n,i,p)=>{if(!i||!p)return;const l=n.getState().scene;l.__r3f&&a(l,i,p)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var i;return!!((i=n==null?void 0:n.__r3f)!=null?i:{}).handlers},prepareUpdate(n,i,p,l){var f;if(((f=n==null?void 0:n.__r3f)!=null?f:{}).primitive&&l.object&&l.object!==n)return[!0];{const{args:b=[],children:d,...u}=l,{args:y=[],children:M,...E}=p;if(!Array.isArray(b))throw new Error("R3F: the args prop must be an array!");if(b.some((C,j)=>C!==y[j]))return[!0];const S=St(n,u,E,!0);return S.changes.length?[!1,S]:null}},commitUpdate(n,[i,p],l,f,x,b){i?g(n,l,x,b):Ae(n,p)},commitMount(n,i,p,l){var f;const x=(f=n.__r3f)!=null?f:{};n.raycast&&x.handlers&&x.eventCount&&Ee(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ie(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var i;const{attach:p,parent:l}=(i=n.__r3f)!=null?i:{};p&&l&&at(l,n,p),n.isObject3D&&(n.visible=!1),se(n)},unhideInstance(n,i){var p;const{attach:l,parent:f}=(p=n.__r3f)!=null?p:{};l&&f&&Oe(f,n,l),(n.isObject3D&&i.visible==null||i.visible)&&(n.visible=!0),se(n)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():ae.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var nt,ot;const je=e=>"colorSpace"in e||"outputColorSpace"in e,ht=()=>{var e;return(e=qe.ColorManagement)!=null?e:null},gt=e=>e&&e.isOrthographicCamera,Cr=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((nt=window.document)!=null&&nt.createElement||((ot=window.navigator)==null?void 0:ot.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function yt(e){const t=m.useRef(e);return ve(()=>void(t.current=e),[e]),t}function Rr({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class bt extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}bt.getDerivedStateFromError=()=>({error:!0});const wt="__default",it=new Map,jr=e=>e&&!!e.memoized&&!!e.changes;function xt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Ee(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:o="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e)||D.boo(e))return e===t;const s=D.obj(e);if(s&&o==="reference")return e===t;const h=D.arr(e);if(h&&r==="reference")return e===t;if((h||s)&&e===t)return!0;let g;for(g in e)if(!(g in t))return!1;if(s&&r==="shallow"&&o==="shallow"){for(g in a?t:e)if(!D.equ(e[g],t[g],{strict:a,objects:"reference"}))return!1}else for(g in a?t:e)if(e[g]!==t[g])return!1;if(D.und(g)){if(h&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Or(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Ar(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ie(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function He(e,t){let r=e;if(t.includes("-")){const o=t.split("-"),a=o.pop();return r=o.reduce((s,h)=>s[h],e),{target:r,key:a}}else return{target:r,key:t}}const st=/-\d+$/;function Oe(e,t,r){if(D.str(r)){if(st.test(r)){const s=r.replace(st,""),{target:h,key:g}=He(e,s);Array.isArray(h[g])||(h[g]=[])}const{target:o,key:a}=He(e,r);t.__r3f.previousAttach=o[a],o[a]=t}else t.__r3f.previousAttach=r(e,t)}function at(e,t,r){var o,a;if(D.str(r)){const{target:s,key:h}=He(e,r),g=t.__r3f.previousAttach;g===void 0?delete s[h]:s[h]=g}else(o=t.__r3f)==null||o.previousAttach==null||o.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function St(e,{children:t,key:r,ref:o,...a},{children:s,key:h,ref:g,...c}={},v=!1){const n=e.__r3f,i=Object.entries(a),p=[];if(v){const f=Object.keys(c);for(let x=0;x<f.length;x++)a.hasOwnProperty(f[x])||i.unshift([f[x],wt+"remove"])}i.forEach(([f,x])=>{var b;if((b=e.__r3f)!=null&&b.primitive&&f==="object"||D.equ(x,c[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return p.push([f,x,!0,[]]);let d=[];f.includes("-")&&(d=f.split("-")),p.push([f,x,!1,d]);for(const u in a){const y=a[u];u.startsWith(`${f}-`)&&p.push([u,y,!1,u.split("-")])}});const l={...a};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(l.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(l.attach=n.memoizedProps.attach),{memoized:l,changes:p}}function Ae(e,t){var r;const o=e.__r3f,a=o==null?void 0:o.root,s=a==null||a.getState==null?void 0:a.getState(),{memoized:h,changes:g}=jr(t)?t:St(e,t),c=o==null?void 0:o.eventCount;e.__r3f&&(e.__r3f.memoizedProps=h);for(let p=0;p<g.length;p++){let[l,f,x,b]=g[p];if(je(e)){const M="srgb",E="srgb-linear";l==="encoding"?(l="colorSpace",f=f===3001?M:E):l==="outputEncoding"&&(l="outputColorSpace",f=f===3001?M:E)}let d=e,u=d[l];if(b.length&&(u=b.reduce((y,M)=>y[M],e),!(u&&u.set))){const[y,...M]=b.reverse();d=M.reverse().reduce((E,S)=>E[S],e),l=y}if(f===wt+"remove")if(d.constructor){let y=it.get(d.constructor);y||(y=new d.constructor,it.set(d.constructor,y)),f=y[l]}else f=0;if(x&&o)f?o.handlers[l]=f:delete o.handlers[l],o.eventCount=Object.keys(o.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Ce)){if(Array.isArray(f))u.fromArray?u.fromArray(f):u.set(...f);else if(u.copy&&f&&f.constructor&&u.constructor===f.constructor)u.copy(f);else if(f!==void 0){var v;const y=(v=u)==null?void 0:v.isColor;!y&&u.setScalar?u.setScalar(f):u instanceof Ce&&f instanceof Ce?u.mask=f.mask:u.set(f),!ht()&&s&&!s.linear&&y&&u.convertSRGBToLinear()}}else{var n;if(d[l]=f,(n=d[l])!=null&&n.isTexture&&d[l].format===er&&d[l].type===tr&&s){const y=d[l];je(y)&&je(s.gl)?y.colorSpace=s.gl.outputColorSpace:y.encoding=s.gl.outputEncoding}}se(e)}if(o&&o.parent&&e.raycast&&c!==o.eventCount){const p=Ee(e).getState().internal,l=p.interaction.indexOf(e);l>-1&&p.interaction.splice(l,1),o.eventCount&&p.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(r=e.__r3f)!=null&&r.parent&&$e(e),e}function se(e){var t,r;const o=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();o&&o.internal.frames===0&&o.invalidate()}function $e(e){e.onUpdate==null||e.onUpdate(e)}function Tr(e,t){e.manual||(gt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Dr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ae.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ae.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ae.ContinuousEventPriority;default:return ae.DefaultEventPriority}}function Et(e,t,r,o){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(o),a.target.releasePointerCapture(o)))}function Lr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(o=>o!==t),r.initialHits=r.initialHits.filter(o=>o!==t),r.hovered.forEach((o,a)=>{(o.eventObject===t||o.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((o,a)=>{Et(r.capturedMap,t,o,a)})}function kr(e){function t(c){const{internal:v}=e.getState(),n=c.offsetX-v.initialClick[0],i=c.offsetY-v.initialClick[1];return Math.round(Math.sqrt(n*n+i*i))}function r(c){return c.filter(v=>["Move","Over","Enter","Out","Leave"].some(n=>{var i;return(i=v.__r3f)==null?void 0:i.handlers["onPointer"+n]}))}function o(c,v){const n=e.getState(),i=new Set,p=[],l=v?v(n.internal.interaction):n.internal.interaction;for(let d=0;d<l.length;d++){const u=fe(l[d]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(c,n);function f(d){const u=fe(d);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var y;u.events.compute==null||u.events.compute(c,u,(y=u.previousRoot)==null?void 0:y.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(d,!0):[]}let x=l.flatMap(f).sort((d,u)=>{const y=fe(d.object),M=fe(u.object);return!y||!M?d.distance-u.distance:M.events.priority-y.events.priority||d.distance-u.distance}).filter(d=>{const u=we(d);return i.has(u)?!1:(i.add(u),!0)});n.events.filter&&(x=n.events.filter(x,n));for(const d of x){let u=d.object;for(;u;){var b;(b=u.__r3f)!=null&&b.eventCount&&p.push({...d,eventObject:u}),u=u.parent}}if("pointerId"in c&&n.internal.capturedMap.has(c.pointerId))for(let d of n.internal.capturedMap.get(c.pointerId).values())i.has(we(d.intersection))||p.push(d.intersection);return p}function a(c,v,n,i){const p=e.getState();if(c.length){const l={stopped:!1};for(const f of c){const x=fe(f.object)||p,{raycaster:b,pointer:d,camera:u,internal:y}=x,M=new $(d.x,d.y,0).unproject(u),E=O=>{var w,_;return(w=(_=y.capturedMap.get(O))==null?void 0:_.has(f.eventObject))!=null?w:!1},S=O=>{const w={intersection:f,target:v.target};y.capturedMap.has(O)?y.capturedMap.get(O).set(f.eventObject,w):y.capturedMap.set(O,new Map([[f.eventObject,w]])),v.target.setPointerCapture(O)},C=O=>{const w=y.capturedMap.get(O);w&&Et(y.capturedMap,f.eventObject,w,O)};let j={};for(let O in v){let w=v[O];typeof w!="function"&&(j[O]=w)}let P={...f,...j,pointer:d,intersections:c,stopped:l.stopped,delta:n,unprojectedPoint:M,ray:b.ray,camera:u,stopPropagation(){const O="pointerId"in v&&y.capturedMap.get(v.pointerId);if((!O||O.has(f.eventObject))&&(P.stopped=l.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(w=>w.eventObject===f.eventObject))){const w=c.slice(0,c.indexOf(f));s([...w,f])}},target:{hasPointerCapture:E,setPointerCapture:S,releasePointerCapture:C},currentTarget:{hasPointerCapture:E,setPointerCapture:S,releasePointerCapture:C},nativeEvent:v};if(i(P),l.stopped===!0)break}}return c}function s(c){const{internal:v}=e.getState();for(const n of v.hovered.values())if(!c.length||!c.find(i=>i.object===n.object&&i.index===n.index&&i.instanceId===n.instanceId)){const p=n.eventObject.__r3f,l=p==null?void 0:p.handlers;if(v.hovered.delete(we(n)),p!=null&&p.eventCount){const f={...n,intersections:c};l.onPointerOut==null||l.onPointerOut(f),l.onPointerLeave==null||l.onPointerLeave(f)}}}function h(c,v){for(let n=0;n<v.length;n++){const i=v[n].__r3f;i==null||i.handlers.onPointerMissed==null||i.handlers.onPointerMissed(c)}}function g(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return v=>{const{internal:n}=e.getState();"pointerId"in v&&n.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(v.pointerId)&&(n.capturedMap.delete(v.pointerId),s([]))})}}return function(n){const{onPointerMissed:i,internal:p}=e.getState();p.lastEvent.current=n;const l=c==="onPointerMove",f=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",b=o(n,l?r:void 0),d=f?t(n):0;c==="onPointerDown"&&(p.initialClick=[n.offsetX,n.offsetY],p.initialHits=b.map(y=>y.eventObject)),f&&!b.length&&d<=2&&(h(n,p.interaction),i&&i(n)),l&&s(b);function u(y){const M=y.eventObject,E=M.__r3f,S=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(l){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const C=we(y),j=p.hovered.get(C);j?j.stopped&&y.stopPropagation():(p.hovered.set(C,y),S.onPointerOver==null||S.onPointerOver(y),S.onPointerEnter==null||S.onPointerEnter(y))}S.onPointerMove==null||S.onPointerMove(y)}else{const C=S[c];C?(!f||p.initialHits.includes(M))&&(h(n,p.interaction.filter(j=>!p.initialHits.includes(j))),C(y)):f&&p.initialHits.includes(M)&&h(n,p.interaction.filter(j=>!p.initialHits.includes(j)))}}a(b,n,d,u)}}return{handlePointer:g}}const Mt=e=>!!(e!=null&&e.render),Pt=m.createContext(null),zr=(e,t)=>{const r=Mr((g,c)=>{const v=new $,n=new $,i=new $;function p(d=c().camera,u=n,y=c().size){const{width:M,height:E,top:S,left:C}=y,j=M/E;u.isVector3?i.copy(u):i.set(...u);const P=d.getWorldPosition(v).distanceTo(i);if(gt(d))return{width:M/d.zoom,height:E/d.zoom,top:S,left:C,factor:1,distance:P,aspect:j};{const O=d.fov*Math.PI/180,w=2*Math.tan(O/2)*P,_=w*(M/E);return{width:_,height:w,top:S,left:C,factor:M/_,distance:P,aspect:j}}}let l;const f=d=>g(u=>({performance:{...u.performance,current:d}})),x=new mt;return{set:g,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(d=1)=>e(c(),d),advance:(d,u)=>t(d,u,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Qt,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const d=c();l&&clearTimeout(l),d.performance.current!==d.performance.min&&f(d.performance.min),l=setTimeout(()=>f(c().performance.max),d.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:d=>g(u=>({...u,events:{...u.events,...d}})),setSize:(d,u,y,M,E)=>{const S=c().camera,C={width:d,height:u,top:M||0,left:E||0,updateStyle:y};g(j=>({size:C,viewport:{...j.viewport,...p(S,n,C)}}))},setDpr:d=>g(u=>{const y=xt(d);return{viewport:{...u.viewport,dpr:y,initialDpr:u.viewport.initialDpr||y}}}),setFrameloop:(d="always")=>{const u=c().clock;u.stop(),u.elapsedTime=0,d!=="never"&&(u.start(),u.elapsedTime=0),g(()=>({frameloop:d}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(d,u,y)=>{const M=c().internal;return M.priority=M.priority+(u>0?1:0),M.subscribers.push({ref:d,priority:u,store:y}),M.subscribers=M.subscribers.sort((E,S)=>E.priority-S.priority),()=>{const E=c().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(u>0?1:0),E.subscribers=E.subscribers.filter(S=>S.ref!==d))}}}}}),o=r.getState();let a=o.size,s=o.viewport.dpr,h=o.camera;return r.subscribe(()=>{const{camera:g,size:c,viewport:v,gl:n,set:i}=r.getState();if(c.width!==a.width||c.height!==a.height||v.dpr!==s){var p;a=c,s=v.dpr,Tr(g,c),n.setPixelRatio(v.dpr);const l=(p=c.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(c.width,c.height,l)}g!==h&&(h=g,i(l=>({viewport:{...l.viewport,...l.viewport.getCurrentViewport(g)}})))}),r.subscribe(g=>e(g)),r};let xe,Fr=new Set,Ir=new Set,Wr=new Set;function Te(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function de(e,t){switch(e){case"before":return Te(Fr,t);case"after":return Te(Ir,t);case"tail":return Te(Wr,t)}}let De,Le;function ke(e,t,r){let o=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(o=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,xe=0;xe<De.length;xe++)Le=De[xe],Le.ref.current(Le.store.getState(),o,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Hr(e){let t=!1,r=!1,o,a,s;function h(v){a=requestAnimationFrame(h),t=!0,o=0,de("before",v),r=!0;for(const i of e.values()){var n;s=i.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((n=s.gl.xr)!=null&&n.isPresenting)&&(o+=ke(v,s))}if(r=!1,de("after",v),o===0)return de("tail",v),t=!1,cancelAnimationFrame(a)}function g(v,n=1){var i;if(!v)return e.forEach(p=>g(p.store.getState(),n));(i=v.gl.xr)!=null&&i.isPresenting||!v.internal.active||v.frameloop==="never"||(n>1?v.internal.frames=Math.min(60,v.internal.frames+n):r?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(h)))}function c(v,n=!0,i,p){if(n&&de("before",v),i)ke(v,i,p);else for(const l of e.values())ke(v,l.store.getState());n&&de("after",v)}return{loop:h,invalidate:g,advance:c}}function _t(){const e=m.useContext(Pt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function N(e=r=>r,t){return _t()(e,t)}function he(e,t=0){const r=_t(),o=r.getState().internal.subscribe,a=yt(e);return ve(()=>o(a,t,r),[t,o,r]),null}const ct=new WeakMap;function Ct(e,t){return function(r,...o){let a=ct.get(r);return a||(a=new r,ct.set(r,a)),e&&e(a),Promise.all(o.map(s=>new Promise((h,g)=>a.load(s,c=>{c.scene&&Object.assign(c,Or(c.scene)),h(c)},t,c=>g(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function J(e,t,r,o){const a=Array.isArray(t)?t:[t],s=Bt(Ct(r,o),[e,...a],{equal:D.equ});return Array.isArray(t)?s:s[0]}J.preload=function(e,t,r){const o=Array.isArray(t)?t:[t];return rr(Ct(r),[e,...o])};J.clear=function(e,t){const r=Array.isArray(t)?t:[t];return nr([e,...r])};const le=new Map,{invalidate:lt,advance:ut}=Hr(le),{reconciler:Me,applyProps:V}=_r(le,Dr),oe={objects:"shallow",strict:!1},$r=(e,t)=>{const r=typeof e=="function"?e(t):e;return Mt(r)?r:new Kt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Br(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:o,height:a,top:s,left:h,updateStyle:g=r}=t;return{width:o,height:a,top:s,left:h,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:a,top:s,left:h}=e.parentElement.getBoundingClientRect();return{width:o,height:a,top:s,left:h,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Nr(e){const t=le.get(e),r=t==null?void 0:t.fiber,o=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,s=o||zr(lt,ut),h=r||Me.createContainer(s,ae.ConcurrentRoot,null,!1,null,"",a,null);t||le.set(e,{fiber:h,store:s});let g,c=!1,v;return{configure(n={}){let{gl:i,size:p,scene:l,events:f,onCreated:x,shadows:b=!1,linear:d=!1,flat:u=!1,legacy:y=!1,orthographic:M=!1,frameloop:E="always",dpr:S=[1,2],performance:C,raycaster:j,camera:P,onPointerMissed:O}=n,w=s.getState(),_=w.gl;w.gl||w.set({gl:_=$r(i,e)});let W=w.raycaster;W||w.set({raycaster:W=new Nt});const{params:q,...k}=j||{};if(D.equ(k,W,oe)||V(W,{...k}),D.equ(q,W.params,oe)||V(W,{params:{...W.params,...q}}),!w.camera||w.camera===v&&!D.equ(v,P,oe)){v=P;const A=P instanceof Jt,T=A?P:M?new Ne(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);A||(T.position.z=5,P&&(V(T,P),("aspect"in P||"left"in P||"right"in P||"bottom"in P||"top"in P)&&(T.manual=!0,T.updateProjectionMatrix())),!w.camera&&!(P!=null&&P.rotation)&&T.lookAt(0,0,0)),w.set({camera:T}),W.camera=T}if(!w.scene){let A;l!=null&&l.isScene?A=l:(A=new Ut,l&&V(A,l)),w.set({scene:ie(A)})}if(!w.xr){var U;const A=(R,Z)=>{const X=s.getState();X.frameloop!=="never"&&ut(R,!0,X,Z)},T=()=>{const R=s.getState();R.gl.xr.enabled=R.gl.xr.isPresenting,R.gl.xr.setAnimationLoop(R.gl.xr.isPresenting?A:null),R.gl.xr.isPresenting||lt(R)},H={connect(){const R=s.getState().gl;R.xr.addEventListener("sessionstart",T),R.xr.addEventListener("sessionend",T)},disconnect(){const R=s.getState().gl;R.xr.removeEventListener("sessionstart",T),R.xr.removeEventListener("sessionend",T)}};typeof((U=_.xr)==null?void 0:U.addEventListener)=="function"&&H.connect(),w.set({xr:H})}if(_.shadowMap){const A=_.shadowMap.enabled,T=_.shadowMap.type;if(_.shadowMap.enabled=!!b,D.boo(b))_.shadowMap.type=_e;else if(D.str(b)){var z;const H={basic:qt,percentage:Vt,soft:_e,variance:Gt};_.shadowMap.type=(z=H[b])!=null?z:_e}else D.obj(b)&&Object.assign(_.shadowMap,b);(A!==_.shadowMap.enabled||T!==_.shadowMap.type)&&(_.shadowMap.needsUpdate=!0)}const F=ht();F&&("enabled"in F?F.enabled=!y:"legacyMode"in F&&(F.legacyMode=y)),c||V(_,{outputEncoding:d?3e3:3001,toneMapping:u?Xt:Yt}),w.legacy!==y&&w.set(()=>({legacy:y})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==u&&w.set(()=>({flat:u})),i&&!D.fun(i)&&!Mt(i)&&!D.equ(i,_,oe)&&V(_,i),f&&!w.events.handlers&&w.set({events:f(s)});const I=Br(e,p);return D.equ(I,w.size,oe)||w.setSize(I.width,I.height,I.updateStyle,I.top,I.left),S&&w.viewport.dpr!==xt(S)&&w.setDpr(S),w.frameloop!==E&&w.setFrameloop(E),w.onPointerMissed||w.set({onPointerMissed:O}),C&&!D.equ(C,w.performance,oe)&&w.set(A=>({performance:{...A.performance,...C}})),g=x,c=!0,this},render(n){return c||this.configure(),Me.updateContainer(G.jsx(Ur,{store:s,children:n,onCreated:g,rootElement:e}),h,null,()=>{}),s},unmount(){Rt(e)}}}function Ur({store:e,children:t,onCreated:r,rootElement:o}){return ve(()=>{const a=e.getState();a.set(s=>({internal:{...s.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(o)},[]),G.jsx(Pt.Provider,{value:e,children:t})}function Rt(e,t){const r=le.get(e),o=r==null?void 0:r.fiber;if(o){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),Me.updateContainer(null,o,null,()=>{a&&setTimeout(()=>{try{var s,h,g,c;a.events.disconnect==null||a.events.disconnect(),(s=a.gl)==null||(h=s.renderLists)==null||h.dispose==null||h.dispose(),(g=a.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(c=a.gl)!=null&&c.xr&&a.xr.disconnect(),Ar(a),le.delete(e)}catch{}},500)})}}Me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Gr(e){const{handlePointer:t}=kr(e);return{priority:1,enabled:!0,compute(r,o,a){o.pointer.set(r.offsetX/o.size.width*2-1,-(r.offsetY/o.size.height)*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)},connected:void 0,handlers:Object.keys(ze).reduce((r,o)=>({...r,[o]:t(o)}),{}),update:()=>{var r;const{events:o,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&o.handlers&&o.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var o;const{set:a,events:s}=e.getState();s.disconnect==null||s.disconnect(),a(h=>({events:{...h.events,connected:r}})),Object.entries((o=s.handlers)!=null?o:[]).forEach(([h,g])=>{const[c,v]=ze[h];r.addEventListener(c,g,{passive:v})})},disconnect:()=>{const{set:r,events:o}=e.getState();if(o.connected){var a;Object.entries((a=o.handlers)!=null?a:[]).forEach(([s,h])=>{if(o&&o.connected instanceof HTMLElement){const[g]=ze[s];o.connected.removeEventListener(g,h)}}),r(s=>({events:{...s.events,connected:void 0}}))}}}}const Vr=m.forwardRef(function({children:t,fallback:r,resize:o,style:a,gl:s,events:h=Gr,eventSource:g,eventPrefix:c,shadows:v,linear:n,flat:i,legacy:p,orthographic:l,frameloop:f,dpr:x,performance:b,raycaster:d,camera:u,scene:y,onPointerMissed:M,onCreated:E,...S},C){m.useMemo(()=>Pr(ar),[]);const j=ir(),[P,O]=sr({scroll:!0,debounce:{scroll:50,resize:0},...o}),w=m.useRef(null),_=m.useRef(null);m.useImperativeHandle(C,()=>w.current);const W=yt(M),[q,k]=m.useState(!1),[U,z]=m.useState(!1);if(q)throw q;if(U)throw U;const F=m.useRef(null);ve(()=>{const A=w.current;O.width>0&&O.height>0&&A&&(F.current||(F.current=Nr(A)),F.current.configure({gl:s,events:h,shadows:v,linear:n,flat:i,legacy:p,orthographic:l,frameloop:f,dpr:x,performance:b,raycaster:d,camera:u,scene:y,size:O,onPointerMissed:(...T)=>W.current==null?void 0:W.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(g?Cr(g)?g.current:g:_.current),c&&T.setEvents({compute:(H,R)=>{const Z=H[c+"X"],X=H[c+"Y"];R.pointer.set(Z/R.size.width*2-1,-(X/R.size.height)*2+1),R.raycaster.setFromCamera(R.pointer,R.camera)}}),E==null||E(T)}}),F.current.render(G.jsx(j,{children:G.jsx(bt,{set:z,children:G.jsx(m.Suspense,{fallback:G.jsx(Rr,{set:k}),children:t??null})})})))}),m.useEffect(()=>{const A=w.current;if(A)return()=>Rt(A)},[]);const I=g?"none":"auto";return G.jsx("div",{ref:_,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:I,...a},...S,children:G.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:w,style:{display:"block"},children:r})})})}),dn=m.forwardRef(function(t,r){return G.jsx(or,{children:G.jsx(Vr,{...t,ref:r})})}),ge=new $,Xe=new $,qr=new $,ft=new mt;function Xr(e,t,r){const o=ge.setFromMatrixPosition(e.matrixWorld);o.project(t);const a=r.width/2,s=r.height/2;return[o.x*a+a,-(o.y*s)+s]}function Yr(e,t){const r=ge.setFromMatrixPosition(e.matrixWorld),o=Xe.setFromMatrixPosition(t.matrixWorld),a=r.sub(o),s=t.getWorldDirection(qr);return a.angleTo(s)>Math.PI/2}function Zr(e,t,r,o){const a=ge.setFromMatrixPosition(e.matrixWorld),s=a.clone();s.project(t),ft.set(s.x,s.y),r.setFromCamera(ft,t);const h=r.intersectObjects(o,!0);if(h.length){const g=h[0].distance;return a.distanceTo(r.ray.origin)<g}return!0}function Kr(e,t){if(t instanceof Ne)return t.zoom;if(t instanceof Ue){const r=ge.setFromMatrixPosition(e.matrixWorld),o=Xe.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,s=r.distanceTo(o);return 1/(2*Math.tan(a/2)*s)}else return 1}function Jr(e,t,r){if(t instanceof Ue||t instanceof Ne){const o=ge.setFromMatrixPosition(e.matrixWorld),a=Xe.setFromMatrixPosition(t.matrixWorld),s=o.distanceTo(a),h=(r[1]-r[0])/(t.far-t.near),g=r[1]-h*t.far;return Math.round(h*s+g)}}const Be=e=>Math.abs(e)<1e-10?0:e;function jt(e,t,r=""){let o="matrix3d(";for(let a=0;a!==16;a++)o+=Be(t[a]*e.elements[a])+(a!==15?",":")");return r+o}const Qr=(e=>t=>jt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),en=(e=>(t,r)=>jt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function tn(e){return e&&typeof e=="object"&&"current"in e}const pn=m.forwardRef(({children:e,eps:t=.001,style:r,className:o,prepend:a,center:s,fullscreen:h,portal:g,distanceFactor:c,sprite:v=!1,transform:n=!1,occlude:i,onOcclude:p,castShadow:l,receiveShadow:f,material:x,geometry:b,zIndexRange:d=[16777271,0],calculatePosition:u=Xr,as:y="div",wrapperClass:M,pointerEvents:E="auto",...S},C)=>{const{gl:j,camera:P,scene:O,size:w,raycaster:_,events:W,viewport:q}=N(),[k]=m.useState(()=>document.createElement(y)),U=m.useRef(),z=m.useRef(null),F=m.useRef(0),I=m.useRef([0,0]),A=m.useRef(null),T=m.useRef(null),H=(g==null?void 0:g.current)||W.connected||j.domElement.parentNode,R=m.useRef(null),Z=m.useRef(!1),X=m.useMemo(()=>i&&i!=="blending"||Array.isArray(i)&&i.length&&tn(i[0]),[i]);m.useLayoutEffect(()=>{const B=j.domElement;i&&i==="blending"?(B.style.zIndex=`${Math.floor(d[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[i]),m.useLayoutEffect(()=>{if(z.current){const B=U.current=xr(k);if(O.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const L=u(z.current,P,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${L[0]}px,${L[1]}px,0);transform-origin:0 0;`}return H&&(a?H.prepend(k):H.appendChild(k)),()=>{H&&H.removeChild(k),B.unmount()}}},[H,n]),m.useLayoutEffect(()=>{M&&(k.className=M)},[M]);const Ze=m.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,s,h,w,n]),Lt=m.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);m.useLayoutEffect(()=>{if(Z.current=!1,n){var B;(B=U.current)==null||B.render(m.createElement("div",{ref:A,style:Ze},m.createElement("div",{ref:T,style:Lt},m.createElement("div",{ref:C,className:o,style:r,children:e}))))}else{var L;(L=U.current)==null||L.render(m.createElement("div",{ref:C,style:Ze,className:o,children:e}))}});const ne=m.useRef(!0);he(B=>{if(z.current){P.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const L=n?I.current:u(z.current,P,w);if(n||Math.abs(F.current-P.zoom)>t||Math.abs(I.current[0]-L[0])>t||Math.abs(I.current[1]-L[1])>t){const Q=Yr(z.current,P);let Y=!1;X&&(Array.isArray(i)?Y=i.map(ee=>ee.current):i!=="blending"&&(Y=[O]));const ue=ne.current;if(Y){const ee=Zr(z.current,P,_,Y);ne.current=ee&&!Q}else ne.current=!Q;ue!==ne.current&&(p?p(!ne.current):k.style.display=ne.current?"block":"none");const ye=Math.floor(d[0]/2),kt=i?X?[d[0],ye]:[ye-1,0]:d;if(k.style.zIndex=`${Jr(z.current,P,kt)}`,n){const[ee,Je]=[w.width/2,w.height/2],Pe=P.projectionMatrix.elements[5]*Je,{isOrthographicCamera:Qe,top:zt,left:Ft,bottom:It,right:Wt}=P,Ht=Qr(P.matrixWorldInverse),$t=Qe?`scale(${Pe})translate(${Be(-(Wt+Ft)/2)}px,${Be((zt+It)/2)}px)`:`translateZ(${Pe}px)`;let te=z.current.matrixWorld;v&&(te=P.matrixWorldInverse.clone().transpose().copyPosition(te).scale(z.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Qe?"":`${Pe}px`,A.current&&T.current&&(A.current.style.transform=`${$t}${Ht}translate(${ee}px,${Je}px)`,T.current.style.transform=en(te,1/((c||10)/400)))}else{const ee=c===void 0?1:Kr(z.current,P)*c;k.style.transform=`translate3d(${L[0]}px,${L[1]}px,0) scale(${ee})`}I.current=L,F.current=P.zoom}}if(!X&&R.current&&!Z.current)if(n){if(A.current){const L=A.current.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const{isOrthographicCamera:Q}=P;if(Q||b)S.scale&&(Array.isArray(S.scale)?S.scale instanceof $?R.current.scale.copy(S.scale.clone().divideScalar(1)):R.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):R.current.scale.setScalar(1/S.scale));else{const Y=(c||10)/400,ue=L.clientWidth*Y,ye=L.clientHeight*Y;R.current.scale.set(ue,ye,1)}Z.current=!0}}}else{const L=k.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const Q=1/q.factor,Y=L.clientWidth*Q,ue=L.clientHeight*Q;R.current.scale.set(Y,ue,1),Z.current=!0}R.current.lookAt(B.camera.position)}});const Ke=m.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return m.createElement("group",K({},S,{ref:z}),i&&!X&&m.createElement("mesh",{castShadow:l,receiveShadow:f,ref:R},b||m.createElement("planeGeometry",null),x||m.createElement("shaderMaterial",{side:cr,vertexShader:Ke.vertexShader,fragmentShader:Ke.fragmentShader})))});let pe=0;const mn=lr(e=>(be.onStart=(t,r,o)=>{e({active:!0,item:t,loaded:r,total:o,progress:(r-pe)/(o-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,o)=>{r===o&&(pe=o),e({active:!0,item:t,loaded:r,total:o,progress:(r-pe)/(o-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Fe=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Ot(e,t){const r=N(s=>s.gl),o=J(Ge,Fe(e)?Object.values(e):e);return m.useLayoutEffect(()=>{t==null||t(o)},[t]),m.useEffect(()=>{if("initTexture"in r){let s=[];Array.isArray(o)?s=o:o instanceof tt?s=[o]:Fe(o)&&(s=Object.values(o)),s.forEach(h=>{h instanceof tt&&r.initTexture(h)})}},[r,o]),m.useMemo(()=>{if(Fe(e)){const s={};let h=0;for(const g in e)s[g]=o[h++];return s}else return o},[e,o])}Ot.preload=e=>J.preload(Ge,e);Ot.clear=e=>J.clear(Ge,e);const rn=()=>parseInt(ur.replace(/\D+/g,"")),At=rn();function nn(e){return Array.isArray(e)}function Ie(e=[0,0,0]){return nn(e)?e:e instanceof $||e instanceof vt?[e.x,e.y,e.z]:[e,e,e]}const vn=m.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:o=-10,map:a,mesh:s,children:h,position:g,rotation:c,scale:v,...n},i){const p=m.useRef(null);m.useImperativeHandle(i,()=>p.current);const l=m.useRef(null),f=m.useRef({position:new $,rotation:new vt,scale:new $(1,1,1)});return m.useLayoutEffect(()=>{const x=(s==null?void 0:s.current)||p.current.parent,b=p.current;if(!(x instanceof fr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(x){V(f.current,{position:g,scale:v});const d=x.matrixWorld.clone();if(x.matrixWorld.identity(),!c||typeof c=="number"){const u=new dr;u.position.copy(f.current.position);const y=x.geometry.attributes.position.array;x.geometry.attributes.normal===void 0&&x.geometry.computeVertexNormals();const M=x.geometry.attributes.normal.array;let E=1/0;new $;let S=new $;const C=u.position.x,j=u.position.y,P=u.position.z,O=y.length;let w=-1;for(let _=0;_<O;_+=3){const W=y[_],q=y[_+1],k=y[_+2],U=W-C,z=q-j,F=k-P,I=U*U+z*z+F*F;I<E&&(E=I,w=_)}S.fromArray(M,w),u.lookAt(u.position.clone().add(S)),u.rotateZ(Math.PI),u.rotateY(Math.PI),typeof c=="number"&&u.rotateZ(c),V(f.current,{rotation:u.rotation})}else V(f.current,{rotation:c});return b.geometry=new pr(x,f.current.position,f.current.rotation,f.current.scale),x.matrixWorld=d,()=>{b.geometry.dispose()}}},[s,...Ie(g),...Ie(v),...Ie(c)]),m.useLayoutEffect(()=>{l.current&&(V(l.current,f.current),l.current.traverse(x=>x.raycast=()=>null))},[t]),m.createElement("mesh",K({ref:p,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":o,"material-depthTest":r,"material-map":a},n),h,t&&m.createElement("mesh",{ref:l},m.createElement("boxGeometry",null),m.createElement("meshNormalMaterial",{wireframe:!0}),m.createElement("axesHelper",null)))});let Se=null,Tt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Dt(e=!0,t=!0,r){return o=>{r&&r(o),e&&(Se||(Se=new mr),Se.setDecoderPath(typeof e=="string"?e:Tt),o.setDRACOLoader(Se)),t&&o.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}const Ye=(e,t,r,o)=>J(Ve,e,Dt(t,r,o));Ye.preload=(e,t,r,o)=>J.preload(Ve,e,Dt(t,r,o));Ye.clear=e=>J.clear(Ve,e);Ye.setDecoderPath=e=>{Tt=e};const hn=m.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:o,enableDamping:a=!0,keyEvents:s=!1,onChange:h,onStart:g,onEnd:c,...v},n)=>{const i=N(S=>S.invalidate),p=N(S=>S.camera),l=N(S=>S.gl),f=N(S=>S.events),x=N(S=>S.setEvents),b=N(S=>S.set),d=N(S=>S.get),u=N(S=>S.performance),y=t||p,M=o||f.connected||l.domElement,E=m.useMemo(()=>new vr(y),[y]);return he(()=>{E.enabled&&E.update()},-1),m.useEffect(()=>(s&&E.connect(s===!0?M:s),E.connect(M),()=>void E.dispose()),[s,M,r,E,i]),m.useEffect(()=>{const S=P=>{i(),r&&u.regress(),h&&h(P)},C=P=>{g&&g(P)},j=P=>{c&&c(P)};return E.addEventListener("change",S),E.addEventListener("start",C),E.addEventListener("end",j),()=>{E.removeEventListener("start",C),E.removeEventListener("end",j),E.removeEventListener("change",S)}},[h,g,c,E,i,x]),m.useEffect(()=>{if(e){const S=d().controls;return b({controls:E}),()=>b({controls:S})}},[e,E]),m.createElement("primitive",K({ref:n,object:E,enableDamping:a},v))}),We=At>=154?"opaque_fragment":"output_fragment";class on extends hr{constructor(t){super(t),this.onBeforeCompile=(r,o)=>{const{isWebGL2:a}=o.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${We}>`,`
        ${a?`#include <${We}>`:`#extension GL_OES_standard_derivatives : enable
#include <${We}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${At>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const gn=m.forwardRef((e,t)=>{const[r]=m.useState(()=>new on(null));return m.createElement("primitive",K({},e,{object:r,ref:t,attach:"material"}))}),yn=m.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:o=1,floatIntensity:a=1,floatingRange:s=[-.1,.1],autoInvalidate:h=!1,...g},c)=>{const v=m.useRef(null);m.useImperativeHandle(c,()=>v.current,[]);const n=m.useRef(Math.random()*1e4);return he(i=>{var p,l;if(!t||r===0)return;h&&i.invalidate();const f=n.current+i.clock.elapsedTime;v.current.rotation.x=Math.cos(f/4*r)/8*o,v.current.rotation.y=Math.sin(f/4*r)/8*o,v.current.rotation.z=Math.sin(f/4*r)/20*o;let x=Math.sin(f/4*r)/10;x=gr.mapLinear(x,-.1,.1,(p=s==null?void 0:s[0])!==null&&p!==void 0?p:-.1,(l=s==null?void 0:s[1])!==null&&l!==void 0?l:.1),v.current.position.y=x*a,v.current.updateMatrix()}),m.createElement("group",g,m.createElement("group",{ref:v,matrixAutoUpdate:!1},e))});let re,me;const sn=m.createContext(null),dt=new yr,pt=new $,an=m.forwardRef(({children:e,range:t,limit:r=1e3,...o},a)=>{const s=m.useRef(null);m.useImperativeHandle(a,()=>s.current,[]);const[h,g]=m.useState([]),[[c,v,n]]=m.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);m.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),dt.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),re=0;re<h.length;re++)me=h[re].current,me.getWorldPosition(pt).applyMatrix4(dt),pt.toArray(c,re*3),s.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(v,re*3),s.current.geometry.attributes.color.needsUpdate=!0,n.set([me.size],re),s.current.geometry.attributes.size.needsUpdate=!0});const i=m.useMemo(()=>({getParent:()=>s,subscribe:p=>(g(l=>[...l,p]),()=>g(l=>l.filter(f=>f.current!==p.current)))}),[]);return m.createElement("points",K({userData:{instances:h},matrixAutoUpdate:!1,ref:s,raycast:()=>null},o),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:ce}),m.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:ce}),m.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ce})),m.createElement(sn.Provider,{value:i},e))}),cn=m.forwardRef(({children:e,positions:t,colors:r,sizes:o,stride:a=3,...s},h)=>{const g=m.useRef(null);return m.useImperativeHandle(h,()=>g.current,[]),he(()=>{const c=g.current.geometry.attributes;c.position.needsUpdate=!0,r&&(c.color.needsUpdate=!0),o&&(c.size.needsUpdate=!0)}),m.createElement("points",K({ref:g},s),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:ce}),r&&m.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:ce}),o&&m.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/a,array:o,itemSize:1,usage:ce})),e)}),bn=m.forwardRef((e,t)=>e.positions instanceof Float32Array?m.createElement(cn,K({},e,{ref:t})):m.createElement(an,K({},e,{ref:t})));function wn({all:e,scene:t,camera:r}){const o=N(({gl:h})=>h),a=N(({camera:h})=>h),s=N(({scene:h})=>h);return m.useLayoutEffect(()=>{const h=[];e&&(t||s).traverse(v=>{v.visible===!1&&(h.push(v),v.visible=!0)}),o.compile(t||s,r||a);const g=new br(128);new wr(.01,1e5,g).update(o,t||s),g.dispose(),h.forEach(v=>v.visible=!1)},[]),null}export{dn as C,vn as D,yn as F,pn as H,hn as O,wn as P,Ye as a,Ot as b,he as c,bn as d,gn as e,mn as u};
